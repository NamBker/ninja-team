<div style="border: 1px solid #e6e6e6;border-radius: 3px;width: 600px">
  <%= form_for  [:user, post],remote: true, url: { controller: "posts", action: "create", user_id: current_user.id }, multipart: true do |f| %>
    <%= f.hidden_field :user_id, value: current_user.id %>
    <div>
      <div class="field " style="margin: 20px 20px ;padding-bottom: 10px">
        <%= f.text_area :content, style: 'border: solid 0px ;color: #262626;font-size: 14px;outline: none;padding: 3px 10px 3px 5px; width: 100%;resize: none;font-family: Open Sans, sans-serif;', placeholder: 'Write something' %>
        <div class="actions" style="border-top: solid 1px #dbdbdb;padding: 20px 20px">
          <div style="float: left;">
            <span style="position: relative;overflow: hidden;display: inline-block;">
                <img src="/assets/picture.png">
                <span>Upload a photo</span>
                <%= f.fields_for :post_attachments do |p| %>

                  <div class="field">
                    <%= p.label :file %><br>
                    <%= p.file_field :file,id: 'files', :multiple => true, name: "post_attachments[file][]" %>
                  </div>
                <% end %>
            </span>
          </div>
          <%= f.submit "Post", class: "btn btn-default", style: 'float: right; padding: 8px 30px' %>
        </div>
        <output id="result" />
      </div>
    </div>
    
    
  <% end %>
</div>
<style>
  #food_food_photos_attributes_0_photo {
    display: block !important;
  }
</style>
<script type="text/javascript">
  window.onload = function(){
        
    //Check File API support
    if(window.File && window.FileList && window.FileReader)
    {
        var filesInput = document.getElementById("files");
        
        filesInput.addEventListener("change", function(event){
            
            var files = event.target.files; //FileList object
            var output = document.getElementById("result");
            
            for(var i = 0; i< files.length; i++)
            {
                var file = files[i];
                
                //Only pics
                if(!file.type.match('image'))
                  continue;
                <%%>
                var picReader = new FileReader();
                
                picReader.addEventListener("load",function(event){
                    
                    var picFile = event.target;
                    
                    var div = document.createElement("div");
                    div.style.display = 'inline-block';
                    div.innerHTML = "<img class='thumbnail' style='width:70px;height:50px' src='" + picFile.result + "'" +
                            "title='" + picFile.name + "'/>";
                    
                    output.insertBefore(div,null);            
                
                });
                
                 //Read the image
                picReader.readAsDataURL(file);
            }                               
           
        });
    }
    else
    {
        console.log("Your browser does not support File API");
    }
}
</script>